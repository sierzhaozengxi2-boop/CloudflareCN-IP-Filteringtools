<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPç­›é€‰æŸ¥è¯¢å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            display: block;
            margin: 0 auto 30px;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            text-align: center;
            margin-bottom: 20px;
            font-size: 16px;
            color: #555;
            min-height: 24px;
        }

        .progress-container {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .result-container {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            display: none;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .node-count {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .copy-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .copy-btn:hover {
            background: #45a049;
        }

        .result-text {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .error {
            color: #f44336;
            font-weight: bold;
        }

        .success {
            color: #4CAF50;
            font-weight: bold;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ IPç­›é€‰æŸ¥è¯¢å·¥å…·</h1>
        
        <button class="btn" id="startBtn" onclick="startProcess()">å¼€å§‹æŸ¥è¯¢</button>
        
        <div class="status" id="status"></div>
        
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>
        
        <div class="result-container" id="resultContainer">
            <div class="result-header">
                <div class="node-count" id="nodeCount">å…± 0 ä¸ªèŠ‚ç‚¹</div>
                <button class="copy-btn" onclick="copyResult()">å¤åˆ¶ç»“æœ</button>
            </div>
            <div class="result-text" id="resultText"></div>
        </div>
    </div>

    <script>
        // åŸå¸‚åç§°ç¿»è¯‘å­—å…¸
        const cityTranslations = {
            'Beijing': 'åŒ—äº¬',
            'Shanghai': 'ä¸Šæµ·',
            'Guangzhou': 'å¹¿å·',
            'Shenzhen': 'æ·±åœ³',
            'Chengdu': 'æˆéƒ½',
            'Hangzhou': 'æ­å·',
            'Wuhan': 'æ­¦æ±‰',
            'Chongqing': 'é‡åº†',
            'Tianjin': 'å¤©æ´¥',
            'Nanjing': 'å—äº¬',
            'Xian': 'è¥¿å®‰',
            'Suzhou': 'è‹å·',
            'Shenyang': 'æ²ˆé˜³',
            'Dongguan': 'ä¸œè',
            'Dalian': 'å¤§è¿',
            'Qingdao': 'é’å²›',
            'Jinan': 'æµå—',
            'Harbin': 'å“ˆå°”æ»¨',
            'Zhengzhou': 'éƒ‘å·',
            'Changsha': 'é•¿æ²™',
            'Kunming': 'æ˜†æ˜',
            'Foshan': 'ä½›å±±',
            'Xiamen': 'å¦é—¨',
            'Hefei': 'åˆè‚¥',
            'Fuzhou': 'ç¦å·',
            'Ningbo': 'å®æ³¢',
            'Shijiazhuang': 'çŸ³å®¶åº„',
            'Guiyang': 'è´µé˜³',
            'Nanchang': 'å—æ˜Œ',
            'Changchun': 'é•¿æ˜¥',
            'Taiyuan': 'å¤ªåŸ',
            'Nanning': 'å—å®',
            'Wenzhou': 'æ¸©å·',
            'Zhuhai': 'ç æµ·',
            'Urumqi': 'ä¹Œé²æœ¨é½',
            'Lanzhou': 'å…°å·',
            'Hohhot': 'å‘¼å’Œæµ©ç‰¹',
            'Yinchuan': 'é“¶å·',
            'Haikou': 'æµ·å£',
            'Lhasa': 'æ‹‰è¨'
        };

        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = isError ? 'status error' : 'status success';
        }

        function updateProgress(percent) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percent + '%';
            progressBar.textContent = Math.round(percent) + '%';
        }

        function translateCity(cityName) {
            if (!cityName) return 'æœªçŸ¥';
            return cityTranslations[cityName] || cityName;
        }

        async function startProcess() {
            const startBtn = document.getElementById('startBtn');
            const progressContainer = document.getElementById('progressContainer');
            const resultContainer = document.getElementById('resultContainer');
            
            startBtn.disabled = true;
            progressContainer.style.display = 'block';
            resultContainer.style.display = 'none';
            updateProgress(0);
            
            try {
                // æ­¥éª¤1: è·å–æ•°æ®
                updateStatus('æ­£åœ¨è·å–æ•°æ®...');
                updateProgress(10);
                
                const response = await fetch('https://raw.githubusercontent.com/papapapapdelesia/Emilia/main/Data/alive.txt');
                if (!response.ok) throw new Error('æ— æ³•è·å–æ•°æ®');
                
                const rawData = await response.text();
                updateProgress(20);
                
                // æ­¥éª¤2: ç­›é€‰åŒ…å«",CN,"çš„è¡Œ
                updateStatus('æ­£åœ¨ç­›é€‰ä¸­å›½IP...');
                const lines = rawData.split('\n').filter(line => line.includes(',CN,'));
                updateProgress(30);
                
                if (lines.length === 0) {
                    throw new Error('æœªæ‰¾åˆ°ä¸­å›½IP');
                }
                
                // æ­¥éª¤3-5: å¤„ç†æ•°æ®æ ¼å¼
                updateStatus('æ­£åœ¨æ ¼å¼åŒ–æ•°æ®...');
                const processedData = [];
                const ipList = [];
                const originalDescriptions = {};
                
                for (let line of lines) {
                    // æå–IPå’Œç«¯å£
                    const parts = line.split(',CN,');
                    if (parts.length < 2) continue;
                    
                    const ipPort = parts[0].replace(',', ':');
                    const description = parts[1].trim();
                    const ip = ipPort.split(':')[0];
                    
                    processedData.push(ipPort + '#');
                    ipList.push(ip);
                    originalDescriptions[ip] = description;
                }
                
                updateProgress(40);
                
                // æ­¥éª¤6: æ‰¹é‡æŸ¥è¯¢IPåœ°ç†ä½ç½®
                updateStatus('æ­£åœ¨æŸ¥è¯¢åœ°ç†ä½ç½®ä¿¡æ¯...');
                
                // ç”±äºAPIå¯èƒ½æœ‰é™åˆ¶ï¼Œæˆ‘ä»¬åˆ†æ‰¹æŸ¥è¯¢
                const batchSize = 50;
                const allGeoData = {};
                
                for (let i = 0; i < ipList.length; i += batchSize) {
                    const batch = ipList.slice(i, i + batchSize);
                    const apiUrl = `https://api.proxynova.com/v1/geolocation/bulk?ip=${batch.join(',')}`;
                    
                    try {
                        const geoResponse = await fetch(apiUrl);
                        if (geoResponse.ok) {
                            const geoData = await geoResponse.json();
                            if (geoData.data) {
                                geoData.data.forEach(item => {
                                    allGeoData[item.ip] = item;
                                });
                            }
                        }
                    } catch (e) {
                        console.warn('æ‰¹æ¬¡æŸ¥è¯¢å¤±è´¥:', e);
                    }
                    
                    updateProgress(40 + (i / ipList.length) * 40);
                    
                    // æ·»åŠ å»¶è¿Ÿé¿å…APIé™åˆ¶
                    if (i + batchSize < ipList.length) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }
                
                updateProgress(80);
                
                // æ­¥éª¤7: æ ¼å¼åŒ–è¾“å‡º
                updateStatus('æ­£åœ¨ç”Ÿæˆç»“æœ...');
                const finalResults = [];
                
                processedData.forEach((item, index) => {
                    const ipPort = item.replace('#', '');
                    const ip = ipPort.split(':')[0];
                    const geoInfo = allGeoData[ip];
                    
                    let region = 'CN';
                    let city = 'æœªçŸ¥';
                    
                    if (geoInfo) {
                        region = geoInfo.region || 'CN';
                        city = translateCity(geoInfo.city);
                    }
                    
                    const lineNumber = index + 1;
                    const description = originalDescriptions[ip] || '';
                    
                    let result = `${ipPort}#${region}${lineNumber} ${city}ä¸­è½¬`;
                    if (description) {
                        result += ` ${description}`;
                    }
                    
                    finalResults.push(result);
                });
                
                updateProgress(100);
                
                // æ˜¾ç¤ºç»“æœ
                updateStatus('æŸ¥è¯¢å®Œæˆï¼', false);
                document.getElementById('nodeCount').textContent = `å…± ${finalResults.length} ä¸ªèŠ‚ç‚¹`;
                document.getElementById('resultText').textContent = finalResults.join('\n');
                resultContainer.style.display = 'block';
                
            } catch (error) {
                updateStatus('é”™è¯¯: ' + error.message, true);
                console.error(error);
            } finally {
                startBtn.disabled = false;
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 2000);
            }
        }

        function copyResult() {
            const resultText = document.getElementById('resultText').textContent;
            navigator.clipboard.writeText(resultText).then(() => {
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'âœ“ å·²å¤åˆ¶';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
    </script>
</body>
</html>