<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP èŠ‚ç‚¹ç­›é€‰å·¥å…· (æš‚åœåŠŸèƒ½+CNä¿®æ­£ç‰ˆ)</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #16a34a;
            --warning: #f59e0b; /* æš‚åœé¢œè‰² */
            --danger: #dc2626;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text: #334155;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        h1 {
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 1.5rem;
            color: #1e293b;
        }

        /* é¡¶éƒ¨é…ç½®æ  */
        .top-panel {
            background: var(--card);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; color: #64748b; }
        .form-group input { 
            padding: 8px; 
            border: 1px solid var(--border); 
            border-radius: 4px; 
            font-size: 0.9rem;
        }

        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            color: white;
            transition: opacity 0.2s;
        }
        button:hover { opacity: 0.9; }
        button:disabled { opacity: 0.5; cursor: not-allowed; background: #94a3b8 !important; }

        #startBtn { background: var(--primary); }
        #pauseBtn { background: var(--warning); display: none; } /* é»˜è®¤éšè— */
        #stopBtn { background: var(--danger); display: none; }
        #downloadBtn { background: var(--success); }

        /* è¿›åº¦æ¡ */
        .progress-wrapper {
            flex-grow: 1;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-left: 15px;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }
        .progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            font-weight: bold;
            top: 0;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 15px;
            flex-grow: 1;
            overflow: hidden; /* é˜²æ­¢æ’‘å¼€ body */
        }

        .panel {
            background: var(--card);
            border-radius: 8px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            padding: 10px;
            background: #f1f5f9;
            border-bottom: 1px solid var(--border);
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
        }

        .log-box {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            background: #1e293b;
            font-family: Consolas, monospace;
            font-size: 12px;
        }
        .log-item { margin-bottom: 4px; line-height: 1.4; color: #cbd5e1; border-bottom: 1px dashed #334155; }
        .log-info { color: #60a5fa; }
        .log-cn { color: #fcd34d; }
        .log-err { color: #f87171; }
        .log-sys { color: #94a3b8; font-style: italic; }

        textarea {
            flex-grow: 1;
            padding: 10px;
            border: none;
            resize: none;
            font-family: Consolas, monospace;
            font-size: 13px;
            outline: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸŒ IP èŠ‚ç‚¹ç­›é€‰å·¥å…· (Fix: CN Region & Pause)</h1>

    <div class="top-panel">
        <div class="config-grid">
            <div class="form-group">
                <label>Raw æºåœ°å€</label>
                <input type="text" id="rawUrl" value="https://raw.githubusercontent.com/papapapapdelesia/Emilia/main/Data/alive.txt">
            </div>
            <div class="form-group">
                <label>API åœ°å€</label>
                <input type="text" id="apiUrl" value="https://api.proxynova.com/v1/geolocation/bulk?ip=">
            </div>
            <div class="form-group">
                <label>æ¯æ‰¹æ•°é‡</label>
                <input type="number" id="batchSize" value="40" min="1" max="100">
            </div>
            <div class="form-group">
                <label>å¹¶å‘å»¶è¿Ÿ (ms)</label>
                <input type="number" id="delayMs" value="350" min="100">
            </div>
        </div>

        <div class="btn-group">
            <button id="startBtn" onclick="startProcess()">å¼€å§‹å¤„ç†</button>
            <button id="pauseBtn" onclick="togglePause()">æš‚åœ</button>
            <button id="downloadBtn" onclick="downloadFile()" disabled>ä¸‹è½½ç»“æœ</button>
            
            <div class="progress-wrapper">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">0%</div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="panel">
            <div class="panel-header">
                <span>è¿è¡Œæ—¥å¿—</span>
                <span id="statusTag">å°±ç»ª</span>
            </div>
            <div class="log-box" id="logArea"></div>
        </div>
        <div class="panel">
            <div class="panel-header">
                <span>ç­›é€‰ç»“æœ (å®æ—¶)</span>
                <span>è¡Œæ•°: <span id="lineCount">0</span></span>
            </div>
            <textarea id="resultArea" placeholder="ç­‰å¾…å¤„ç†..."></textarea>
        </div>
    </div>
</div>

<script>
    // ================= é…ç½®ä¸å­—å…¸ =================

    // ä¸­å›½çœä»½/ç›´è¾–å¸‚æ˜ å°„è¡¨ (åŒ…å«ä»£ç ã€ä¸­æ–‡åã€å¸¸è§çš„è‹±æ–‡å˜ä½“)
    // é”®åå…¨éƒ¨å°å†™ä»¥æ–¹ä¾¿åŒ¹é…
    const cnMap = {
        // --- åä¸œ ---
        "shanghai": { c: "SH", n: "ä¸Šæµ·" }, "sh": { c: "SH", n: "ä¸Šæµ·" }, "31": { c: "SH", n: "ä¸Šæµ·" },
        "jiangsu": { c: "JS", n: "æ±Ÿè‹" }, "js": { c: "JS", n: "æ±Ÿè‹" }, "nanjing": { c: "JS", n: "æ±Ÿè‹" }, "suzhou": { c: "JS", n: "æ±Ÿè‹" },
        "zhejiang": { c: "ZJ", n: "æµ™æ±Ÿ" }, "zj": { c: "ZJ", n: "æµ™æ±Ÿ" }, "hangzhou": { c: "ZJ", n: "æµ™æ±Ÿ" },
        "anhui": { c: "AH", n: "å®‰å¾½" }, "ah": { c: "AH", n: "å®‰å¾½" }, "hefei": { c: "AH", n: "å®‰å¾½" },
        "fujian": { c: "FJ", n: "ç¦å»º" }, "fj": { c: "FJ", n: "ç¦å»º" }, "fuzhou": { c: "FJ", n: "ç¦å»º" }, "xiamen": { c: "FJ", n: "ç¦å»º" },
        "jiangxi": { c: "JX", n: "æ±Ÿè¥¿" }, "jx": { c: "JX", n: "æ±Ÿè¥¿" },
        "shandong": { c: "SD", n: "å±±ä¸œ" }, "sd": { c: "SD", n: "å±±ä¸œ" }, "qingdao": { c: "SD", n: "å±±ä¸œ" }, "jinan": { c: "SD", n: "å±±ä¸œ" },
        
        // --- ååŒ— ---
        "beijing": { c: "BJ", n: "åŒ—äº¬" }, "bj": { c: "BJ", n: "åŒ—äº¬" }, "11": { c: "BJ", n: "åŒ—äº¬" },
        "tianjin": { c: "TJ", n: "å¤©æ´¥" }, "tj": { c: "TJ", n: "å¤©æ´¥" }, "12": { c: "TJ", n: "å¤©æ´¥" },
        "hebei": { c: "HE", n: "æ²³åŒ—" }, "he": { c: "HE", n: "æ²³åŒ—" },
        "shanxi": { c: "SX", n: "å±±è¥¿" }, "sx": { c: "SX", n: "å±±è¥¿" },
        "inner mongolia": { c: "NM", n: "å†…è’™å¤" }, "neimenggu": { c: "NM", n: "å†…è’™å¤" }, "nm": { c: "NM", n: "å†…è’™å¤" },

        // --- åå— ---
        "guangdong": { c: "GD", n: "å¹¿ä¸œ" }, "gd": { c: "GD", n: "å¹¿ä¸œ" }, "44": { c: "GD", n: "å¹¿ä¸œ" }, 
        "guangzhou": { c: "GD", n: "å¹¿ä¸œ" }, "shenzhen": { c: "GD", n: "å¹¿ä¸œ" }, // æ·±åœ³æš‚æ—¶å½’ä¸ºå¹¿ä¸œä»£ç ï¼Œä½†åå­—å¯ä»¥ç‰¹åˆ¤
        "guangxi": { c: "GX", n: "å¹¿è¥¿" }, "gx": { c: "GX", n: "å¹¿è¥¿" },
        "hainan": { c: "HI", n: "æµ·å—" }, "hi": { c: "HI", n: "æµ·å—" },
        "hong kong": { c: "HK", n: "é¦™æ¸¯" }, "hk": { c: "HK", n: "é¦™æ¸¯" },
        "macau": { c: "MO", n: "æ¾³é—¨" }, "mo": { c: "MO", n: "æ¾³é—¨" },

        // --- åä¸­ ---
        "henan": { c: "HA", n: "æ²³å—" }, "ha": { c: "HA", n: "æ²³å—" },
        "hubei": { c: "HB", n: "æ¹–åŒ—" }, "hb": { c: "HB", n: "æ¹–åŒ—" }, "wuhan": { c: "HB", n: "æ¹–åŒ—" },
        "hunan": { c: "HN", n: "æ¹–å—" }, "hn": { c: "HN", n: "æ¹–å—" }, "changsha": { c: "HN", n: "æ¹–å—" },

        // --- è¥¿å— ---
        "chongqing": { c: "CQ", n: "é‡åº†" }, "cq": { c: "CQ", n: "é‡åº†" }, "50": { c: "CQ", n: "é‡åº†" },
        "sichuan": { c: "SC", n: "å››å·" }, "sc": { c: "SC", n: "å››å·" }, "chengdu": { c: "SC", n: "å››å·" },
        "guizhou": { c: "GZ", n: "è´µå·" }, "gz": { c: "GZ", n: "è´µå·" }, 
        "yunnan": { c: "YN", n: "äº‘å—" }, "yn": { c: "YN", n: "äº‘å—" },
        "tibet": { c: "XZ", n: "è¥¿è—" }, "xizang": { c: "XZ", n: "è¥¿è—" }, "xz": { c: "XZ", n: "è¥¿è—" },

        // --- è¥¿åŒ— ---
        "shaanxi": { c: "SN", n: "é™•è¥¿" }, "sn": { c: "SN", n: "é™•è¥¿" }, "xi'an": { c: "SN", n: "é™•è¥¿" },
        "gansu": { c: "GS", n: "ç”˜è‚ƒ" }, "gs": { c: "GS", n: "ç”˜è‚ƒ" },
        "qinghai": { c: "QH", n: "é’æµ·" }, "qh": { c: "QH", n: "é’æµ·" },
        "ningxia": { c: "NX", n: "å®å¤" }, "nx": { c: "NX", n: "å®å¤" },
        "xinjiang": { c: "XJ", n: "æ–°ç–†" }, "xj": { c: "XJ", n: "æ–°ç–†" },

        // --- å°æ¹¾ ---
        "taiwan": { c: "TW", n: "å°æ¹¾" }, "tw": { c: "TW", n: "å°æ¹¾" }, "taipei": { c: "TW", n: "å°æ¹¾" }
    };

    // å…¨çƒå›½å®¶ä»£ç  -> ä¸­æ–‡
    const countryMap = {
        "CN": "ä¸­å›½", "US": "ç¾å›½", "HK": "é¦™æ¸¯", "JP": "æ—¥æœ¬", "KR": "éŸ©å›½", "SG": "æ–°åŠ å¡", 
        "TW": "å°æ¹¾", "GB": "è‹±å›½", "DE": "å¾·å›½", "NL": "è·å…°", "RU": "ä¿„ç½—æ–¯", "FR": "æ³•å›½",
        "CA": "åŠ æ‹¿å¤§", "AU": "æ¾³å¤§åˆ©äºš", "TH": "æ³°å›½", "VN": "è¶Šå—", "ID": "å°å°¼", "IN": "å°åº¦",
        "PH": "è²å¾‹å®¾", "MY": "é©¬æ¥è¥¿äºš", "BR": "å·´è¥¿", "IT": "æ„å¤§åˆ©", "ES": "è¥¿ç­ç‰™",
        "SE": "ç‘å…¸", "CH": "ç‘å£«", "TR": "åœŸè€³å…¶", "ZA": "å—é", "PL": "æ³¢å…°", "IR": "ä¼Šæœ—",
        "UA": "ä¹Œå…‹å…°", "AE": "é˜¿è”é…‹", "MO": "æ¾³é—¨", "AR": "é˜¿æ ¹å»·", "KZ": "å“ˆè¨å…‹æ–¯å¦"
    };

    // ================= å…¨å±€å˜é‡ =================
    let isProcessing = false;
    let isPaused = false;
    let results = []; // å­˜å‚¨æœ€ç»ˆç»“æœæ–‡æœ¬

    // ================= å·¥å…·å‡½æ•° =================
    
    function log(msg, type='sys') {
        const box = document.getElementById('logArea');
        const d = new Date();
        const time = `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}:${d.getSeconds().toString().padStart(2,'0')}`;
        box.innerHTML += `<div class="log-item log-${type}">[${time}] ${msg}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    // å…³é”®ä¿®å¤ï¼šCN åœ°åŒºè¯†åˆ«
    function getCNInfo(apiInfo, entryAsn) {
        // apiInfo åŒ…å«: region_code, region_name, city, region ç­‰å­—æ®µï¼ˆè§† API è€Œå®šï¼‰
        // entryAsn æ˜¯ RAW æ•°æ®é‡Œçš„ ASN å­—ç¬¦ä¸²
        
        let foundCode = "";
        let foundName = "";

        // 1. æ•°æ®æ¸…æ´—ï¼šæ”¶é›†æ‰€æœ‰å¯èƒ½åŒ…å«åœ°ç†ä¿¡æ¯çš„å­—æ®µ
        // æ³¨æ„ï¼šAPI è¿”å›çš„é”®åå¯èƒ½ä¸ç»Ÿä¸€ï¼Œå…¨éƒ¨å°è¯•è·å–
        const clues = [
            apiInfo.region_code,           // æœ€å‡†ç¡®ï¼šå¦‚ "GD", "44"
            apiInfo.region,                // åç§°ï¼šGuangdong
            apiInfo.region_name,           // åç§°å˜ä½“
            apiInfo.principalSubdivision,  // æŸäº›APIä½¿ç”¨æ­¤å­—æ®µ
            apiInfo.city                   // åŸå¸‚ï¼šShenzhen
        ].filter(Boolean).map(s => String(s).trim().toLowerCase());

        // 2. éå† API çº¿ç´¢åŒ¹é…å­—å…¸
        for (let clue of clues) {
            // å»é™¤å¹²æ‰°è¯
            let clean = clue.replace(/province|city|region|autonomous/g, '').trim();
            if (cnMap[clean]) {
                foundCode = cnMap[clean].c;
                foundName = cnMap[clean].n;
                
                // ç‰¹æ®Šå¤„ç†ï¼šå¦‚æœæ˜¯æ·±åœ³ï¼Œä»£ç ç”¨ GDï¼Œä½†åå­—æ˜¾ç¤ºæ·±åœ³
                if (clean.includes('shenzhen')) foundName = "æ·±åœ³";
                if (clean.includes('beijing')) foundName = "åŒ—äº¬";
                if (clean.includes('shanghai')) foundName = "ä¸Šæµ·";
                
                break; // æ‰¾åˆ°å³æ­¢
            }
        }

        // 3. å¦‚æœ API æ²¡æ‰¾åˆ°ï¼Œæ‰«æ ASN æ–‡æœ¬ (Fallback)
        if (!foundCode && entryAsn) {
            const asnLower = entryAsn.toLowerCase();
            for (let key in cnMap) {
                // è·³è¿‡çŸ­ key é¿å…è¯¯åˆ¤ (å¦‚ 'he', 'hi')ï¼Œé™¤éæ˜ç¡®æ˜¯çœä»½å…¨æ‹¼
                if (key.length < 3 && key !== 'bj' && key !== 'sh') continue;
                
                if (asnLower.includes(key)) {
                    foundCode = cnMap[key].c;
                    foundName = cnMap[key].n;
                    if (key.includes('shenzhen')) foundName = "æ·±åœ³";
                    break;
                }
            }
        }

        // 4. æœ€ç»ˆå…œåº•
        if (!foundCode) {
            return { codeStr: "CN", nameStr: "ä¸­å›½" }; // æ— æ³•è¯†åˆ«å…·ä½“çœä»½ï¼Œåªæ˜¾ç¤º CN å’Œ ä¸­å›½
        }

        return { codeStr: "CN" + foundCode, nameStr: foundName };
    }


    // ================= ä¸»é€»è¾‘ =================

    async function startProcess() {
        if (isProcessing) return;
        
        // åˆå§‹åŒ– UI
        isProcessing = true;
        isPaused = false;
        results = [];
        document.getElementById('startBtn').disabled = true;
        document.getElementById('pauseBtn').style.display = "inline-block";
        document.getElementById('pauseBtn').textContent = "æš‚åœ";
        document.getElementById('pauseBtn').disabled = false;
        document.getElementById('downloadBtn').disabled = true;
        document.getElementById('logArea').innerHTML = "";
        document.getElementById('resultArea').value = "";
        document.getElementById('statusTag').textContent = "è¿è¡Œä¸­";
        document.getElementById('statusTag').style.color = "var(--primary)";

        const rawUrl = document.getElementById('rawUrl').value;
        const apiUrlBase = document.getElementById('apiUrl').value;
        const batchSize = parseInt(document.getElementById('batchSize').value) || 40;
        const delayMs = parseInt(document.getElementById('delayMs').value) || 350;

        try {
            log("æ­£åœ¨ä¸‹è½½ Raw æ•°æ®...", "sys");
            const res = await fetch(rawUrl);
            if (!res.ok) throw new Error("Raw æ•°æ®ä¸‹è½½å¤±è´¥: " + res.status);
            const text = await res.text();
            
            // è§£æ Raw
            const lines = text.split('\n').map(l=>l.trim()).filter(l=>l);
            const entries = [];
            lines.forEach(l => {
                const p = l.split(',');
                if (p.length >= 4) {
                    entries.push({
                        ip: p[0].trim(),
                        port: p[1].trim(),
                        code: p[2].trim().toUpperCase(),
                        asn: p.slice(3).join(',').trim()
                    });
                }
            });

            log(`è§£æå®Œæˆï¼Œå…± ${entries.length} ä¸ª IPã€‚å¼€å§‹ API æ‰¹é‡æŸ¥è¯¢...`, "info");

            // æ‰¹å¤„ç†å¾ªç¯
            for (let i = 0; i < entries.length; i += batchSize) {
                
                // --- æš‚åœé€»è¾‘ ---
                while (isPaused) {
                    document.getElementById('statusTag').textContent = "å·²æš‚åœ";
                    document.getElementById('statusTag').style.color = "var(--warning)";
                    await sleep(200);
                }
                document.getElementById('statusTag').textContent = "è¿è¡Œä¸­";
                document.getElementById('statusTag').style.color = "var(--primary)";
                // ----------------

                const batch = entries.slice(i, i + batchSize);
                const ips = batch.map(e => e.ip).join(',');
                const url = `${apiUrlBase}${ips}`;

                try {
                    // API è¯·æ±‚
                    const apiRes = await fetch(url);
                    let apiData = {};
                    if (apiRes.ok) {
                        const json = await apiRes.json();
                        // å…¼å®¹ ProxyNova è¿”å›æ ¼å¼ (æœ‰æ—¶æ˜¯ array, æœ‰æ—¶æ˜¯ object map)
                        if (Array.isArray(json)) {
                            json.forEach(item => { if(item.ip) apiData[item.ip] = item; });
                        } else {
                            apiData = json;
                        }
                    } else {
                        log(`Batch ${Math.floor(i/batchSize)+1} API å¤±è´¥ (${apiRes.status})`, "err");
                    }

                    // æ ¼å¼åŒ–è¾“å‡º
                    batch.forEach(entry => {
                        const info = apiData[entry.ip] || {};
                        // ä¼˜å…ˆç”¨ API å›½å®¶ç ï¼Œå¦åˆ™ç”¨ RAW
                        const cCode = (info.country_code || entry.code).toUpperCase();
                        
                        let lineStr = "";

                        if (cCode === 'CN') {
                            // è°ƒç”¨å¢å¼ºçš„ CN è¯†åˆ«é€»è¾‘
                            const cnInfo = getCNInfo(info, entry.asn);
                            // æ ¼å¼: 59.36.147.253:10011#CN3 æ·±åœ³ä¸­è½¬ CHINANET...
                            lineStr = `${entry.ip}:${entry.port}#${cnInfo.codeStr} ${cnInfo.nameStr}ä¸­è½¬ ${entry.asn}`;
                            // log(`CN IP: ${cnInfo.nameStr} (${entry.ip})`, "cn");
                        } else {
                            // é CN é€»è¾‘
                            const cName = countryMap[cCode] || info.country_name || cCode;
                            // æ ¼å¼: 167.17.183.134:443#CH å¾·å›½ç›´è¿ Baxet...
                            lineStr = `${entry.ip}:${entry.port}#${cCode} ${cName}ç›´è¿ ${entry.asn}`;
                        }
                        results.push(lineStr);
                    });

                    // æ›´æ–° UI
                    const currentCount = Math.min(i + batchSize, entries.length);
                    const percent = Math.floor((currentCount / entries.length) * 100);
                    
                    document.getElementById('progressBar').style.width = percent + "%";
                    document.getElementById('progressText').innerText = percent + "%";
                    document.getElementById('resultArea').value = results.join('\n');
                    document.getElementById('resultArea').scrollTop = document.getElementById('resultArea').scrollHeight;
                    document.getElementById('lineCount').textContent = results.length;

                } catch (batchErr) {
                    log(`æ‰¹æ¬¡å¤„ç†å¼‚å¸¸: ${batchErr.message}`, "err");
                    // å³ä½¿å‡ºé”™ä¹Ÿä¿ç•™åŸå§‹æ•°æ®
                    batch.forEach(e => results.push(`${e.ip}:${e.port}#${e.code} æœªçŸ¥ç›´è¿ ${e.asn}`));
                }

                // å»¶è¿Ÿ
                if (i + batchSize < entries.length) await sleep(delayMs);
            }

            log("æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæˆã€‚", "info");
            document.getElementById('downloadBtn').disabled = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').style.display = "none";
            document.getElementById('statusTag').textContent = "å®Œæˆ";
            document.getElementById('statusTag').style.color = "var(--success)";

        } catch (e) {
            log(`è‡´å‘½é”™è¯¯: ${e.message}`, "err");
            document.getElementById('startBtn').disabled = false;
        } finally {
            isProcessing = false;
        }
    }

    function togglePause() {
        isPaused = !isPaused;
        const btn = document.getElementById('pauseBtn');
        if (isPaused) {
            btn.textContent = "ç»§ç»­";
            btn.style.background = "var(--success)";
            log("ç”¨æˆ·å·²æš‚åœ", "sys");
        } else {
            btn.textContent = "æš‚åœ";
            btn.style.background = "var(--warning)";
            log("ç”¨æˆ·ç»§ç»­ä»»åŠ¡", "sys");
        }
    }

    function downloadFile() {
        const text = document.getElementById('resultArea').value;
        const blob = new Blob([text], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `proxies_${new Date().toISOString().slice(0,10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>

</body>
</html>